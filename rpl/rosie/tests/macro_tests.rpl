
package macros

import "../test/backref-rpl" as bref

-- // TODO

t1 = find:"a"
-- test t1 rejects "", "b", "bbb"
-- test t1 accepts "a", "aa", "ba", "bba"
-- test t1 assert "aaa" == "a"
-- test t1 assert "bbaa" == "bba"
-- test t1 assert find:* "bbaa" == "a"

t2 = find:"help"
-- test t2 rejects ""
-- test t2 accepts "help"
-- test t2 assert find:* "help" == "help"
-- test t2 assert "test this help me" == "test this help"
-- test t2 assert find:* "test this help me" == "test this help"

t3 = find:{"c" [:alnum:]+ <"i"}
-- test t3 rejects ""
-- test t3 accepts "cli"
-- test t3 assert find:* "cli" == "cli"
-- test t3 assert "test change cli something" == "test change cli"
-- test t3 assert find:* "test change cli something" == "cli"
-- test t3 assert "test change cli something ccc cllli xxx" == "test change cli"

t4 = find:ci:"a"
-- test t4 rejects ""
-- test t4 accepts "a", "A", "bbba", "BbBa"
-- test t4 assert "aaa" == "a"

t5 = find:ci:"ab"
-- test t5 rejects ""
-- test t5 accepts "123ab", "123Ab"

t6 = find:ci:[a]
-- test t6 rejects "", "1234"
-- test t6 accepts "123a"
-- test t7 assert "123Ab" == "123A"

t7 = keepto:"a"
-- test t7 rejects ""
-- test t7 accepts "a"
-- test t7 assert find:<search> "a" == ""
-- test t7 assert "aaa" == "a"
-- test t7 assert find:<search> "aaa" == ""
-- test t7 assert find:* "aaa" == "a"
-- test t7 assert "bbba" == "bbba"
-- test t7 assert find:<search> "bbba" == "bbb"
-- test t7 assert find:* "bbba" == "a"

t8 = findall:"a"
-- test t8 rejects ""
-- test t8 accepts "a", "aaa", "bbba", "bbba cca"
-- test t8 assert find:* "a" == "a"
-- test t8 assert find:* "aaa" == ["a", "a", "a"]
-- test t8 assert find:* "bbba" == ["a"]
-- test t8 assert find:* "bbba cca" == ["a", "a"]

t9_delimiter = [+/|]
grammar
	-- // Note: The result is true, because of "" matching everything, the 'balanced' is empty.
	t9_balanced = { t9_delimiter t9_balanced backref:t9_delimiter } / ""
end
-- test t9_balanced accepts "", "++", "a+", "+||+"
-- test t9_balanced assert t9_delimiter "++" == "+"
-- test t9_balanced assert "a+" == ""
-- test t9_balanced assert t9_delimiter "+||+" == "+"
-- test t9_balanced assert t9_balanced.t9_delimiter "+||+" == "|"
-- test t9_balanced assert "+|/+" == ""

t10 = bref.onetag
-- test t10 rejects ""
-- test t10 accepts "<foo></foo>"
-- test t10 accepts "<foo> blah blah</foo>"
-- test t10 rejects "<foo> blah blah</foo2>"

t11 = bref.html
-- test t11 rejects ""
-- test t11 accepts "<foo><bar></bar></foo>"
-- test t11 accepts "<foo></foo><bar></bar>"

t12 = find:{<"com"}
-- test t12 rejects ""
-- test t12 accepts "com"
-- test t12 assert find:* "com" == ""
-- test t12 accepts "bla.bla.com"
-- test t12 assert find:* "bla.bla.com" == ""

t13 = find:{!"1"}
-- test t13 accepts ""
-- test t13 assert "com" == ""
-- test t13 assert "111112" == "11111"

t14 = quote:{[""''] [\\] [\n]}
-- test t14 rejects ""
-- test t14 accepts "'test'"
-- test t14 accepts "\"help\""
-- test t14 accepts "\"he\'lp\""
-- test t14 rejects "\"help\ntest\""
-- test t14 rejects "\"abc'"

-- 'until' always returns true
t15 = until:"\n"
-- test t15 accepts "", "abc"
-- test t15 assert "abc\n123" == "abc\n"
-- test t15 assert "\n123" == "\n"
